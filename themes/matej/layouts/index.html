{{ define "main" }}
<div class="main-container">
    {{ partial "profile.html" . }}

    <div class="content-area">
        {{ $pages := where .Site.RegularPages "Section" "posts" }}
        {{ $groups := slice }}

        <!-- Collect unique groups -->
        {{ range $pages }}
        {{ $group := .Params.group | default "uncategorized" }}
        {{ if not (in $groups $group) }}
        {{ $groups = $groups | append $group }}
        {{ end }}
        {{ end }}

        <div class="content-groups">
            {{ range $groups }}
            {{ $currentGroup := . }}
            <div class="content-group">
                <h2 class="group-title">{{ $currentGroup }}</h2>

                {{ range $pages }}
                {{ if eq (.Params.group | default "uncategorized") $currentGroup }}
                <article class="post-item">
                    <a href="{{ .RelPermalink }}" class="post-link"></a>
                    {{ if .Params.thumbnail }}
                    <img src="{{ .Params.thumbnail | relURL }}" alt="{{ .Title }}" class="post-thumbnail">
                    {{ else }}
                    <div class="post-thumbnail"></div>
                    {{ end }}

                    <div class="post-info">
                        <div class="post-date">{{ .Date.Format "2006-01-02" }}</div>
                        <h3 class="post-title">{{ .Title }}</h3>
                    </div>
                </article>
                {{ end }}
                {{ end }}
            </div>
            {{ end }}
        </div>
    </div>
</div>
{{ end }}